name: OpenWrtä¼˜åŒ–ç¼–è¯‘ï¼ˆäº‘ç«¯æ™ºèƒ½ç©ºé—´ç®¡ç†ï¼‰

on:
  workflow_dispatch:
    inputs:
      compile_threads:
        description: 'ç¼–è¯‘çº¿ç¨‹æ•°'
        required: false
        default: '1'
        type: choice
        options:
          - '1'
          - '2'
      skip_downloads:
        description: 'è·³è¿‡è½¯ä»¶åŒ…ä¸‹è½½ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'

env:
  REPO_URL: https://github.com/coolsnowwolf/lede
  BUILD_DIR: openwrt-build
  CACHE_DIR: /tmp/openwrt-cache

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 480

    steps:
    - name: æ£€å‡ºä»“åº“ä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: æ£€æŸ¥ä»“åº“æ–‡ä»¶
      run: |
        echo "=== æ£€æŸ¥ä»“åº“æ–‡ä»¶ ==="
        echo "å½“å‰å·¥ä½œç›®å½•: $(pwd)"
        echo "å·¥ä½œç›®å½•å†…å®¹:"
        ls -la
        
        echo ""
        echo "=== é…ç½®æ–‡ä»¶éªŒè¯ ==="
        if [ -f ".config" ]; then
          echo "âœ… æ‰¾åˆ° .config æ–‡ä»¶"
          echo "  è·¯å¾„: $(pwd)/.config"
          echo "  å¤§å°: $(ls -lh .config | awk '{print $5}')"
          echo "  è¡Œæ•°: $(wc -l < .config)"
        else
          echo "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ° .config æ–‡ä»¶"
          exit 1
        fi
        
        echo ""
        if [ -f "feed.conf.default" ]; then
          echo "âœ… æ‰¾åˆ° feed.conf.default æ–‡ä»¶"
          echo "  è·¯å¾„: $(pwd)/feed.conf.default"
          echo "  å¤§å°: $(ls -lh feed.conf.default | awk '{print $5}')"
          echo "  è¡Œæ•°: $(wc -l < feed.conf.default)"
          echo "  å†…å®¹é¢„è§ˆ:"
          head -10 feed.conf.default
        else
          echo "âš ï¸ è­¦å‘Šï¼šæœªæ‰¾åˆ° feed.conf.default æ–‡ä»¶ï¼Œå°†ä½¿ç”¨æºç é»˜è®¤é…ç½®"
        fi

    - name: åˆå§‹åŒ–ç¯å¢ƒï¼ˆæè‡´ç©ºé—´ä¼˜åŒ–ï¼‰
      run: |
        echo "=== åˆå§‹ç³»ç»ŸçŠ¶æ€ ==="
        df -h
        free -h
        
        # åˆ›å»ºå¤§å®¹é‡äº¤æ¢åˆ†åŒºï¼ˆ4GBï¼‰
        echo "åˆ›å»º4GBäº¤æ¢åˆ†åŒº..."
        sudo swapoff -a 2>/dev/null || true
        sudo rm -f /swapfile* 2>/dev/null || true
        sudo fallocate -l 4G /swapfile
        sudo chmod 600 /swapfile
        sudo mkswap /swapfile
        sudo swapon /swapfile
        echo "vm.swappiness=100" | sudo tee -a /etc/sysctl.conf
        sudo sysctl -p
        
        # æè‡´æ¸…ç†ç³»ç»Ÿç©ºé—´
        echo "æ‰§è¡Œæè‡´ç©ºé—´æ¸…ç†..."
        
        # æ¸…ç†æ‰€æœ‰ç¼“å­˜
        sudo apt-get autoremove --purge -y
        sudo apt-get autoclean -y
        sudo apt-get clean -y
        
        # å¼ºåˆ¶æ¸…ç†ç³»ç»Ÿç¼“å­˜
        sudo rm -rf /var/cache/apt/archives/*
        sudo rm -rf /var/cache/apt/archives/partial/*
        sudo rm -rf /var/lib/apt/lists/*
        
        # æ¸…ç†ä¸´æ—¶ç›®å½•
        sudo rm -rf /tmp/* /var/tmp/*
        
        # åˆ›å»ºç¼“å­˜ç›®å½•
        mkdir -p "$CACHE_DIR"
        
        echo "=== ä¼˜åŒ–åç³»ç»ŸçŠ¶æ€ ==="
        df -h
        free -h

    - name: å®‰è£…æœ€å°ç¼–è¯‘ç¯å¢ƒ
      run: |
        echo "å®‰è£…æœ€å°å¿…éœ€ç¼–è¯‘å·¥å…·..."
        sudo apt-get update
        
        # ç»å¯¹æœ€å°å·¥å…·é›†
        sudo DEBIAN_FRONTEND=noninteractive apt-get install -y \
          build-essential \
          git \
          libncurses5-dev \
          libssl-dev \
          python3 \
          unzip \
          wget \
          curl \
          gcc \
          g++ \
          binutils \
          patch \
          bzip2 \
          flex \
          make \
          rsync \
          cmake \
          gawk \
          sed \
          gettext \
          pkg-config \
          libtool \
          zlib1g-dev \
          subversion \
          automake \
          autoconf \
          texinfo
        
        echo "ç¼–è¯‘ç¯å¢ƒå®‰è£…å®Œæˆ"

    - name: å…‹éš†æºç 
      run: |
        # åˆ é™¤æ—§ç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        rm -rf "$BUILD_DIR"
        
        echo "å¼€å§‹å…‹éš†OpenWrtæºç ..."
        git clone --depth=1 --single-branch --branch master "$REPO_URL" "$BUILD_DIR"
        
        if [ $? -ne 0 ]; then
          echo "âŒ æºç å…‹éš†å¤±è´¥"
          exit 1
        fi
        
        echo "âœ… æºç å…‹éš†å®Œæˆ"
        echo "æºç ç›®å½•: $(pwd)/$BUILD_DIR"
        echo "æºç å¤§å°: $(du -sh $BUILD_DIR | cut -f1)"

    - name: åº”ç”¨é…ç½®æ–‡ä»¶ï¼ˆå…³é”®æ­¥éª¤ï¼‰
      run: |
        echo "=== åº”ç”¨é…ç½®æ–‡ä»¶ ==="
        echo "å½“å‰ç›®å½•: $(pwd)"
        echo "BUILD_DIR: $BUILD_DIR"
        
        # éªŒè¯æºæ–‡ä»¶å­˜åœ¨
        echo ""
        echo "éªŒè¯æºæ–‡ä»¶:"
        ls -la .config feed.conf.default 2>/dev/null || echo "æŸäº›æ–‡ä»¶ä¸å­˜åœ¨"
        
        # è¿›å…¥ç¼–è¯‘ç›®å½•
        cd "$BUILD_DIR"
        echo "ç°åœ¨åœ¨ç¼–è¯‘ç›®å½•: $(pwd)"
        
        # æ˜¾ç¤ºç¼–è¯‘ç›®å½•å†…å®¹
        echo "ç¼–è¯‘ç›®å½•å†…å®¹:"
        ls -la
        
        echo ""
        echo "=== å¤åˆ¶é…ç½®æ–‡ä»¶ ==="
        
        # å¤åˆ¶ .config æ–‡ä»¶
        if [ -f "../.config" ]; then
          echo "å¤åˆ¶ .config æ–‡ä»¶..."
          cp "../.config" .
          echo "âœ… .config å·²å¤åˆ¶"
          echo "éªŒè¯: $(ls -lh .config)"
        else
          echo "âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ° ../.config æ–‡ä»¶"
          exit 1
        fi
        
        # å¤åˆ¶ feed.conf.default æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        echo ""
        if [ -f "../feed.conf.default" ]; then
          echo "å¤åˆ¶ feed.conf.default æ–‡ä»¶..."
          cp "../feed.conf.default" .
          echo "âœ… feed.conf.default å·²å¤åˆ¶"
          echo "éªŒè¯: $(ls -lh feed.conf.default)"
          
          # æ˜¾ç¤ºfeedé…ç½®
          echo ""
          echo "=== æ‚¨çš„feedé…ç½® ==="
          cat feed.conf.default
          echo "=== ç»“æŸfeedé…ç½® ==="
        else
          echo "âš ï¸ è­¦å‘Šï¼šæœªæ‰¾åˆ° ../feed.conf.default æ–‡ä»¶ï¼Œä½¿ç”¨æºç é»˜è®¤é…ç½®"
          echo "é»˜è®¤feedé…ç½®:"
          head -10 feed.conf.default 2>/dev/null || echo "æ— æ³•è¯»å–é»˜è®¤feedé…ç½®"
        fi
        
        # éªŒè¯æ–‡ä»¶å·²æˆåŠŸå¤åˆ¶
        echo ""
        echo "=== æ–‡ä»¶å¤åˆ¶éªŒè¯ ==="
        if [ -f ".config" ]; then
          echo "âœ… .config æ–‡ä»¶å­˜åœ¨"
        else
          echo "âŒ .config æ–‡ä»¶ä¸å­˜åœ¨"
          exit 1
        fi
        
        if [ -f "feed.conf.default" ]; then
          echo "âœ… feed.conf.default æ–‡ä»¶å­˜åœ¨"
        else
          echo "âš ï¸ feed.conf.default æ–‡ä»¶ä¸å­˜åœ¨"
        fi

    - name: æ™ºèƒ½ä¸‹è½½ç®¡ç†å™¨
      run: |
        cd "$BUILD_DIR"
        
        echo "å½“å‰ç›®å½•: $(pwd)"
        echo "ç›®å½•å†…å®¹:"
        ls -la
        
        # åˆ›å»ºä¸‹è½½ç›®å½•ç¬¦å·é“¾æ¥åˆ°ç¼“å­˜
        rm -rf dl
        mkdir -p "$CACHE_DIR/dl"
        ln -s "$CACHE_DIR/dl" dl
        
        if [ "${{ github.event.inputs.skip_downloads }}" = "true" ] && [ -d "$CACHE_DIR/dl" ] && [ "$(ls -A $CACHE_DIR/dl 2>/dev/null)" ]; then
          echo "ğŸ“¦ ä½¿ç”¨ç¼“å­˜çš„ä¸‹è½½æ–‡ä»¶"
          echo "ç¼“å­˜å¤§å°: $(du -sh $CACHE_DIR/dl 2>/dev/null || echo '0')"
        else
          echo "ğŸŒ å¼€å§‹ä¸‹è½½è½¯ä»¶åŒ…..."
          
          # ç›‘æ§ç£ç›˜ç©ºé—´å‡½æ•°
          monitor_disk_space() {
            while true; do
              USAGE=$(df / --output=pcent | tail -1 | tr -d ' %')
              if [ "$USAGE" -gt 90 ]; then
                echo "âš ï¸ ç£ç›˜ä½¿ç”¨ç‡ $USAGE%ï¼Œæ¸…ç†æ—§ä¸‹è½½..."
                find "$CACHE_DIR/dl" -type f \( -name "*.tar.*" -o -name "*.zip" -o -name "*.gz" -o -name "*.bz2" \) 2>/dev/null | \
                  xargs ls -t 2>/dev/null | tail -10 | xargs rm -f 2>/dev/null || true
              fi
              sleep 30
            done
          }
          
          # å¯åŠ¨ç›‘æ§
          monitor_disk_space &
          MONITOR_PID=$!
          trap "kill $MONITOR_PID 2>/dev/null || true" EXIT
          
          echo "ä¸‹è½½åŸºç¡€å·¥å…·é“¾..."
          make tools/download -j1 V=s || echo "å·¥å…·é“¾ä¸‹è½½æœ‰è­¦å‘Š"
          
          kill $MONITOR_PID 2>/dev/null || true
          
          echo "å‹ç¼©ä¸‹è½½æ–‡ä»¶ä»¥èŠ‚çœç©ºé—´..."
          find "$CACHE_DIR/dl" -name "*.tar" -type f -exec gzip -f {} \; 2>/dev/null || true
        fi
        
        echo "âœ… ä¸‹è½½ç®¡ç†å®Œæˆ"
        echo "å½“å‰ä¸‹è½½ç¼“å­˜: $(du -sh $CACHE_DIR/dl 2>/dev/null || echo 'ç©º')"

    - name: é…ç½®å’Œå‡†å¤‡ç¼–è¯‘ç¯å¢ƒ
      run: |
        cd "$BUILD_DIR"
        
        echo "å½“å‰ç›®å½•: $(pwd)"
        echo "ç›®å½•å†…å®¹:"
        ls -la
        
        # éªŒè¯é…ç½®æ–‡ä»¶å­˜åœ¨
        echo ""
        echo "=== éªŒè¯é…ç½®æ–‡ä»¶ ==="
        if [ ! -f ".config" ]; then
          echo "âŒ é”™è¯¯ï¼š.config æ–‡ä»¶ä¸å­˜åœ¨"
          exit 1
        fi
        
        if [ ! -f "feed.conf.default" ]; then
          echo "âš ï¸ è­¦å‘Šï¼šfeed.conf.default æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®"
        else
          echo "âœ… feed.conf.default æ–‡ä»¶å­˜åœ¨"
          echo "feedé…ç½®å†…å®¹:"
          echo "--------------------------------"
          cat feed.conf.default
          echo "--------------------------------"
        fi
        
        # å…³é”®ï¼šä½¿ç”¨æ‚¨çš„feedé…ç½®æ›´æ–°feeds
        echo ""
        echo "=== ä½¿ç”¨æ‚¨çš„feedé…ç½®æ›´æ–°feeds ==="
        ./scripts/feeds update -a
        
        echo "å®‰è£…é€‰å®šçš„è½¯ä»¶åŒ…..."
        ./scripts/feeds install -a
        
        echo "åº”ç”¨é…ç½®..."
        make defconfig
        
        echo "=== ç¼–è¯‘å‰ç£ç›˜ç©ºé—´ ==="
        df -h

    - name: æ™ºèƒ½åˆ†æ­¥ç¼–è¯‘ï¼ˆå¸¦å®æ—¶ç©ºé—´å›æ”¶ï¼‰
      run: |
        cd "$BUILD_DIR"
        THREADS=${{ github.event.inputs.compile_threads }}
        
        # ç©ºé—´å›æ”¶å‡½æ•°
        reclaim_space() {
          local level=$1
          echo "æ‰§è¡Œç©ºé—´å›æ”¶ï¼ˆçº§åˆ«$levelï¼‰..."
          
          case $level in
            1)
              find . -name "*.o" -type f -delete 2>/dev/null || true
              ;;
            2)
              find . -name "*.o" -type f -delete 2>/dev/null || true
              find . -name "*.a" -type f -delete 2>/dev/null || true
              
              if [ -d "$CACHE_DIR/dl" ]; then
                find "$CACHE_DIR/dl" -type f \( -name "*.tar.*" -o -name "*.zip" -o -name "*.gz" \) 2>/dev/null | \
                  xargs ls -t 2>/dev/null | tail -n +21 | xargs rm -f 2>/dev/null || true
              fi
              ;;
            3)
              find build_dir -type f \( -name "*.o" -o -name "*.a" -o -name "*.lo" \) -delete 2>/dev/null || true
              
              if [ -d "$CACHE_DIR/dl" ]; then
                find "$CACHE_DIR/dl" -type f \( -name "*.tar.*" -o -name "*.zip" -o -name "*.gz" \) 2>/dev/null | \
                  xargs ls -t 2>/dev/null | tail -n +11 | xargs rm -f 2>/dev/null || true
              fi
              
              sudo rm -rf /tmp/*
              ;;
          esac
          
          echo "å›æ”¶åç£ç›˜: $(df -h / | tail -1)"
        }
        
        # ç£ç›˜ç›‘æ§å‡½æ•°
        start_disk_monitor() {
          while true; do
            USAGE=$(df / --output=pcent | tail -1 | tr -d ' %')
            AVAIL=$(df / --output=avail | tail -1 | tr -d ' ')
            
            if [ "$USAGE" -gt 80 ]; then
              echo "âš ï¸ ç£ç›˜ä½¿ç”¨ç‡ $USAGE%ï¼Œå¯ç”¨ç©ºé—´ ${AVAIL}KB"
              
              if [ "$USAGE" -gt 95 ]; then
                echo "ğŸš¨ ç´§æ€¥ï¼šç£ç›˜ä½¿ç”¨ç‡ $USAGE%ï¼Œæš‚åœç¼–è¯‘ï¼"
                pkill -f "make.*-j$THREADS" 2>/dev/null || true
                sleep 2
                reclaim_space 3
                echo "ğŸ”„ ç»§ç»­ç¼–è¯‘..."
              elif [ "$USAGE" -gt 90 ]; then
                echo "âš ï¸ è­¦å‘Šï¼šç£ç›˜ä½¿ç”¨ç‡ $USAGE%ï¼Œæ‰§è¡Œé‡åº¦æ¸…ç†"
                reclaim_space 2
              elif [ "$USAGE" -gt 85 ]; then
                echo "âš ï¸ æ³¨æ„ï¼šç£ç›˜ä½¿ç”¨ç‡ $USAGE%ï¼Œæ‰§è¡Œè½»åº¦æ¸…ç†"
                reclaim_space 1
              fi
            fi
            
            sleep 15
          done
        }
        
        # å¯åŠ¨ç›‘æ§
        start_disk_monitor &
        MONITOR_PID=$!
        trap "kill $MONITOR_PID 2>/dev/null || true" EXIT
        
        # ç¼–è¯‘æ­¥éª¤å‡½æ•°
        compile_with_retry() {
          local target=$1
          local max_retries=2
          local retry_count=0
          
          while [ $retry_count -lt $max_retries ]; do
            echo "ç¼–è¯‘ $target (å°è¯• $((retry_count+1))/$max_retries)"
            
            AVAIL=$(df / --output=avail | tail -1 | tr -d ' ')
            if [ "$AVAIL" -lt 1048576 ]; then
              echo "ç¼–è¯‘å‰ç©ºé—´ä¸è¶³ï¼Œæ‰§è¡Œæ¸…ç†..."
              reclaim_space 2
            fi
            
            if make $target -j$THREADS; then
              echo "âœ… $target ç¼–è¯‘æˆåŠŸ"
              find . -name "*.o" -type f -delete 2>/dev/null || true
              return 0
            else
              retry_count=$((retry_count+1))
              echo "âŒ $target ç¼–è¯‘å¤±è´¥ï¼Œé‡è¯• $retry_count/$max_retries"
              reclaim_space 2
              
              if [ $retry_count -eq $max_retries ]; then
                echo "å°è¯•å•çº¿ç¨‹ç¼–è¯‘..."
                if make $target -j1 V=s; then
                  echo "âœ… $target å•çº¿ç¨‹ç¼–è¯‘æˆåŠŸ"
                  return 0
                fi
              fi
              
              sleep 10
            fi
          done
          
          echo "âŒ $target ç¼–è¯‘æœ€ç»ˆå¤±è´¥"
          return 1
        }
        
        echo "å¼€å§‹æ™ºèƒ½åˆ†æ­¥ç¼–è¯‘..."
        
        # åˆ†æ­¥ç¼–è¯‘
        compile_with_retry "tools/compile" || echo "âš ï¸ å·¥å…·é“¾ç¼–è¯‘æœ‰é—®é¢˜ï¼Œç»§ç»­..."
        compile_with_retry "toolchain/compile" || echo "âš ï¸ ç›®æ ‡å·¥å…·é“¾ç¼–è¯‘æœ‰é—®é¢˜ï¼Œç»§ç»­..."
        compile_with_retry "target/compile" || echo "âš ï¸ ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿç¼–è¯‘æœ‰é—®é¢˜ï¼Œç»§ç»­..."
        compile_with_retry "package/compile" || echo "âš ï¸ è½¯ä»¶åŒ…ç¼–è¯‘æœ‰é—®é¢˜ï¼Œç»§ç»­..."
        
        kill $MONITOR_PID 2>/dev/null || true
        
        echo "âœ… åˆ†æ­¥ç¼–è¯‘å®Œæˆ"

    - name: æœ€ç»ˆç¼–è¯‘å’Œæ‰“åŒ…
      run: |
        cd "$BUILD_DIR"
        THREADS=${{ github.event.inputs.compile_threads }}
        
        echo "æ‰§è¡Œæœ€ç»ˆç¼–è¯‘å’Œæ‰“åŒ…..."
        echo "=== æœ€ç»ˆç¼–è¯‘å‰ç£ç›˜ç©ºé—´ ==="
        df -h
        
        AVAIL=$(df / --output=avail | tail -1 | tr -d ' ')
        if [ "$AVAIL" -lt 524288 ]; then
          echo "ğŸš¨ æœ€ç»ˆç¼–è¯‘å‰ç©ºé—´ä¸¥é‡ä¸è¶³ï¼Œæ‰§è¡Œç´§æ€¥æ¸…ç†..."
          find . -name "*.o" -type f -delete 2>/dev/null || true
          find . -name "*.a" -type f -delete 2>/dev/null || true
          
          if [ -d "$CACHE_DIR/dl" ]; then
            find "$CACHE_DIR/dl" -type f \( -name "*.tar.*" -o -name "*.zip" -o -name "*.gz" \) 2>/dev/null | \
              xargs ls -t 2>/dev/null | tail -n +6 | xargs rm -f 2>/dev/null || true
          fi
        fi
        
        echo "æ‰§è¡Œmakeï¼ˆæœ€ç»ˆæ­¥éª¤ï¼‰..."
        if make -j$THREADS; then
          echo "ğŸ‰ æœ€ç»ˆç¼–è¯‘æˆåŠŸï¼"
        else
          echo "âŒ æœ€ç»ˆç¼–è¯‘å¤±è´¥ï¼Œå°è¯•å•çº¿ç¨‹..."
          if make -j1 V=s; then
            echo "ğŸ‰ å•çº¿ç¨‹æœ€ç»ˆç¼–è¯‘æˆåŠŸï¼"
          else
            echo "âŒ æœ€ç»ˆç¼–è¯‘å¤±è´¥"
            exit 1
          fi
        fi

    - name: æ”¶é›†å’ŒéªŒè¯ç”Ÿæˆçš„æ–‡ä»¶
      run: |
        if [ ! -d "$BUILD_DIR" ]; then
          echo "âŒ é”™è¯¯ï¼š$BUILD_DIR ç›®å½•ä¸å­˜åœ¨"
          exit 1
        fi
        
        cd "$BUILD_DIR"
        
        echo "ğŸ” æŸ¥æ‰¾ç”Ÿæˆçš„å›ºä»¶..."
        
        FIRMWARE_FILES=$(find bin -type f \( -name "*.bin" -o -name "*.img" -o -name "*.gz" -o -name "*.trx" \) 2>/dev/null || true)
        
        if [ -n "$FIRMWARE_FILES" ]; then
          echo "âœ… æ‰¾åˆ°å›ºä»¶æ–‡ä»¶:"
          echo "$FIRMWARE_FILES"
          echo ""
          
          for file in $FIRMWARE_FILES; do
            if [ -f "$file" ]; then
              echo "ğŸ“„ $file: $(ls -lh "$file" | awk '{print $5}')"
            fi
          done
          
          echo ""
          echo "ğŸ“¦ å›ºä»¶ç›®å½•æ€»å¤§å°:"
          du -sh bin/targets/* 2>/dev/null || du -sh bin/* 2>/dev/null || true
        else
          echo "âŒ æœªæ‰¾åˆ°å›ºä»¶æ–‡ä»¶"
          echo "æ£€æŸ¥æ—¥å¿—ä»¥ç¡®å®šç¼–è¯‘å¤±è´¥åŸå› "
          ls -la bin/ 2>/dev/null || true
          exit 1
        fi
        
        echo "=== æœ€ç»ˆç³»ç»ŸçŠ¶æ€ ==="
        df -h
        free -h

    - name: ä¸Šä¼ å›ºä»¶æ–‡ä»¶
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: openwrt-firmware
        path: ${{ env.BUILD_DIR }}/bin/
        retention-days: 30
        if-no-files-found: error

    - name: æ¸…ç†ç¼“å­˜
      if: always()
      run: |
        echo "æ¸…ç†ç¼–è¯‘ç¼“å­˜..."
        rm -rf "$CACHE_DIR" 2>/dev/null || true
        sudo rm -f /swapfile 2>/dev/null || true

    - name: å®Œæˆæ€»ç»“
      if: always()
      run: |
        if [ "${{ job.status }}" == "success" ]; then
          echo ""
          echo "ğŸŠğŸŠğŸŠ ç¼–è¯‘æˆåŠŸå®Œæˆï¼ ğŸŠğŸŠğŸŠ"
          echo "================================="
          echo "ğŸ“¥ å›ºä»¶æ–‡ä»¶å¯åœ¨ Artifacts åŒºåŸŸä¸‹è½½"
          echo "================================="
          echo "é…ç½®ä½¿ç”¨æƒ…å†µ:"
          echo "- âœ… ä½¿ç”¨äº†æ‚¨çš„ .config æ–‡ä»¶"
          echo "- âœ… ä½¿ç”¨äº†æ‚¨çš„ feed.conf.default æ–‡ä»¶"
          echo "================================="
        else
          echo ""
          echo "âŒâŒâŒ ç¼–è¯‘å¤±è´¥ï¼ âŒâŒâŒ"
          echo "================================="
          echo "å¯èƒ½åŸå› ï¼š"
          echo "1. ç£ç›˜ç©ºé—´ä¸è¶³ - ç²¾ç®€.configæ–‡ä»¶ä¸­çš„è½¯ä»¶åŒ…"
          echo "2. feedé…ç½®é”™è¯¯ - æ£€æŸ¥feed.conf.defaultæ–‡ä»¶"
          echo "3. ä¾èµ–ç¼ºå¤± - æ£€æŸ¥ç¼–è¯‘æ—¥å¿—"
          echo ""
          echo "ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š"
          echo "1. å‡å°‘.configä¸­çš„è½¯ä»¶åŒ…æ•°é‡"
          echo "2. æ£€æŸ¥feed.conf.defaultæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®"
          echo "3. æŸ¥çœ‹è¯¦ç»†çš„ç¼–è¯‘é”™è¯¯æ—¥å¿—"
          echo "================================="
        fi
