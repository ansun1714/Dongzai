name: ğŸ  æ ‹ä»”ä¸»é¢˜ä¸ªæ€§åŒ–å›ºä»¶ç¼–è¯‘3

on:
  workflow_dispatch:
    inputs:
      clean_build:
        description: 'æ˜¯å¦æ¸…ç†é‡æ–°ç¼–è¯‘'
        required: false
        default: false
        type: boolean
      compile_threads:
        description: 'ç¼–è¯‘çº¿ç¨‹æ•° (æ¨è1-2)'
        required: false
        default: 1
        type: choice
        options:
        - 1
        - 2

env:
  REPO_URL: https://github.com/coolsnowwolf/lede
  BUILD_DIR: lede

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 360  # 6å°æ—¶è¶…æ—¶

    steps:
    - name: ğŸ“‹ åˆå§‹åŒ–æ£€æŸ¥
      uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: ğŸ” éªŒè¯é…ç½®æ–‡ä»¶
      id: config_check
      run: |
        echo "=== é…ç½®æ–‡ä»¶éªŒè¯ ==="
        if [ ! -f ".config" ]; then
          echo "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ° .config æ–‡ä»¶"
          echo "è¯·åœ¨ä»“åº“æ ¹ç›®å½•åˆ›å»º .config æ–‡ä»¶æ¥æŒ‡å®šè®¾å¤‡é…ç½®"
          exit 1
        fi
        
        CONFIG_LINES=$(wc -l < .config)
        echo "âœ… æ‰¾åˆ°é…ç½®æ–‡ä»¶ (.config)ï¼ŒåŒ…å« $CONFIG_LINES è¡Œé…ç½®"
        
        # æ˜¾ç¤ºå…³é”®é…ç½®ä¿¡æ¯
        echo ""
        echo "=== é…ç½®æ‘˜è¦ ==="
        echo "ç›®æ ‡å¹³å°: $(grep 'CONFIG_TARGET_[^=]*=y' .config | head -1 | sed 's/CONFIG_//' || echo 'æœªè®¾ç½®')"
        echo "ç›®æ ‡è®¾å¤‡: $(grep 'CONFIG_TARGET.*DEVICE.*=y' .config | head -1 | sed 's/CONFIG_//' || echo 'æœªè®¾ç½®')"
        echo "LuCIç•Œé¢: $(grep 'CONFIG_PACKAGE_luci=y' .config && echo 'å¯ç”¨' || echo 'ç¦ç”¨')"
        
        # æ£€æŸ¥Node.jsçŠ¶æ€
        if grep -q "# CONFIG_PACKAGE_node is not set" .config; then
          echo "âœ… Node.js å·²ç¦ç”¨"
        else
          echo "âš ï¸  Node.js æœªæ˜ç¡®ç¦ç”¨ï¼Œå°†åœ¨åç»­æ­¥éª¤ä¸­å¤„ç†"
        fi

    - name: ğŸ› ï¸ å®‰è£…ç¼–è¯‘ç¯å¢ƒ
      run: |
        echo "=== å®‰è£…ç¼–è¯‘å·¥å…·é“¾ ==="
        start_time=$(date +%s)
        
        sudo apt-get update
        echo "ğŸ“¦ å®‰è£…åŸºç¡€ç¼–è¯‘å·¥å…·..."
        sudo apt-get install -y \
          build-essential \
          ccache \
          git \
          libncurses5-dev \
          libssl-dev \
          python3 \
          unzip \
          wget \
          curl \
          rsync \
          file \
          gawk \
          gettext \
          zlib1g-dev
        
        # å®‰è£…å®Œæ•´å·¥å…·é“¾
        echo "ğŸ“¦ å®‰è£…å®Œæ•´OpenWrtç¼–è¯‘å·¥å…·..."
        sudo apt-get install -y \
          subversion \
          flex \
          uglifyjs \
          gcc-multilib \
          p7zip-full \
          msmtp \
          texinfo \
          libglib2.0-dev \
          xmlto \
          upx \
          libelf-dev \
          autoconf \
          automake \
          libtool \
          autopoint \
          device-tree-compiler
        
        end_time=$(date +%s)
        duration=$((end_time - start_time))
        echo "âœ… ç¯å¢ƒå®‰è£…å®Œæˆ (è€—æ—¶: ${duration}ç§’)"

    - name: ğŸ“¥ å…‹éš†Leanæºç 
      run: |
        echo "=== å…‹éš†OpenWrtæºç  ==="
        
        if [ -d "$BUILD_DIR" ] && [ "${{ github.event.inputs.clean_build }}" = "true" ]; then
          echo "ğŸ§¹ æ¸…ç†æ—§ç¼–è¯‘ç›®å½•..."
          rm -rf $BUILD_DIR
        fi
        
        if [ ! -d "$BUILD_DIR" ]; then
          echo "ğŸ“¥ ä» Lean ä»“åº“å…‹éš†æºç ..."
          git clone --depth 1 $REPO_URL $BUILD_DIR
          echo "âœ… æºç å…‹éš†å®Œæˆ"
        else
          echo "âœ… ä½¿ç”¨ç°æœ‰æºç ç›®å½•"
        fi

    - name: ğŸ”„ æ›´æ–°è½¯ä»¶æº
      run: |
        cd $BUILD_DIR
        echo "=== æ›´æ–°è½¯ä»¶æºå’ŒåŒ… ==="
        
        echo "ğŸ”„ æ›´æ–°è½¯ä»¶æº..."
        ./scripts/feeds update -a
        echo "ğŸ“¦ å®‰è£…è½¯ä»¶åŒ…..."
        ./scripts/feeds install -a
        echo "âœ… è½¯ä»¶æºæ›´æ–°å®Œæˆ"

    - name: ğŸš« å½»åº•å¤„ç†Node.jsé—®é¢˜
      run: |
        cd $BUILD_DIR
        echo "=== å½»åº•å¤„ç†Node.jsç¼–è¯‘é—®é¢˜ ==="
        
        # æ–¹æ³•1: ä»feedsä¸­ç§»é™¤nodeåŒ…
        echo "ğŸ—‘ï¸  ä»feedsä¸­ç§»é™¤Node.jsåŒ…..."
        if [ -d "feeds/packages/lang/node" ]; then
          rm -rf feeds/packages/lang/node
          echo "âœ… ç§»é™¤ feeds/packages/lang/node"
        fi
        
        # æ–¹æ³•2: ç¡®ä¿packageç›®å½•ä¸­ä¹Ÿæ²¡æœ‰node
        if [ -d "package/feeds/packages/node" ]; then
          rm -rf package/feeds/packages/node
          echo "âœ… ç§»é™¤ package/feeds/packages/node"
        fi
        
        # æ–¹æ³•3: åˆ›å»ºç©ºçš„nodeç›®å½•é¿å…ä¾èµ–é”™è¯¯
        mkdir -p feeds/packages/lang/node
        touch feeds/packages/lang/node/Makefile
        echo "âœ… åˆ›å»ºç©ºNode.jsç›®å½•é¿å…ä¾èµ–é”™è¯¯"
        
        # æ–¹æ³•4: æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–åŒ…ä¾èµ–node
        echo "ğŸ” æ£€æŸ¥å¯èƒ½ä¾èµ–Node.jsçš„åŒ…..."
        find feeds packages -name "Makefile" -type f -exec grep -l "node\|npm" {} \; | head -5 || echo "æœªæ‰¾åˆ°æ˜æ˜¾ä¾èµ–"

    - name: ğŸ¨ éƒ¨ç½²æ ‹ä»”ä¸»é¢˜
      run: |
        cd $BUILD_DIR
        echo "=== éƒ¨ç½²ä¸ªæ€§åŒ–ä¸»é¢˜ ==="
        
        THEME_DIR="package/lean/dongzhai-theme/luci-theme-dongzhai"
        
        # åˆ›å»ºä¸»é¢˜ç›®å½•ç»“æ„
        echo "ğŸ“ åˆ›å»ºä¸»é¢˜ç›®å½•..."
        mkdir -p $THEME_DIR/files/www/luci-static/dongzhai/css
        
        # åˆ›å»ºä¸»é¢˜Makefile
        echo "ğŸ“ åˆ›å»ºä¸»é¢˜ç¼–è¯‘é…ç½®..."
        cat > $THEME_DIR/Makefile << 'EOF'
include $(TOPDIR)/rules.mk

LUCI_TITLE:=æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜
LUCI_DEPENDS:=
PKG_VERSION:=1.0
PKG_RELEASE:=1

include $(INCLUDE_DIR)/package.mk

define Package/luci-theme-dongzhai
  $(call Package/luci/webtemplate)
  TITLE:=æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜
  DEPENDS:=+luci-compat
endef

define Package/luci-theme-dongzhai/description
  æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜ - ä¸“ä¸ºä¸ªæ€§åŒ–å®šåˆ¶
endef

define Build/Configure
endef

define Build/Compile
endef

define Package/luci-theme-dongzhai/install
	$(INSTALL_DIR) $(1)/www/luci-static/dongzhai
	[ -d ./files ] && $(CP) ./files/* $(1)/www/luci-static/dongzhai/
endef

$(eval $(call BuildPackage,luci-theme-dongzhai))
EOF

        # åˆ›å»ºä¸»é¢˜æ ·å¼æ–‡ä»¶
        echo "ğŸ¨ åˆ›å»ºä¸»é¢˜æ ·å¼..."
        cat > $THEME_DIR/files/www/luci-static/dongzhai/css/style.css << 'EOF'
/* æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜æ ·å¼ */
.header .fill .brand {
    color: #ff6600;
    font-weight: bold;
    font-size: 18px;
}

.sidebar {
    background: #2c3e50;
}

.sidebar .nav > li > a {
    color: #ecf0f1;
}

.btn-primary {
    background-color: #ff6600;
    border-color: #ff6600;
}

.dongzhai-badge {
    background: #e74c3c;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    margin-left: 5px;
}
EOF

        echo "âœ… æ ‹ä»”ä¸»é¢˜éƒ¨ç½²å®Œæˆ"

    - name: âš™ï¸ åº”ç”¨ç¼–è¯‘é…ç½®ï¼ˆå½»åº•ç¦ç”¨Node.jsï¼‰
      run: |
        cd $BUILD_DIR
        echo "=== åº”ç”¨ç¼–è¯‘é…ç½® ==="
        
        # å¤åˆ¶ç”¨æˆ·é…ç½®æ–‡ä»¶
        echo "ğŸ“„ åº”ç”¨ç”¨æˆ·é…ç½®..."
        cp ../.config .config
        
        # å½»åº•ç¦ç”¨æ‰€æœ‰Node.jsç›¸å…³é…ç½®
        echo "ğŸš« å½»åº•ç¦ç”¨Node.jså’Œç›¸å…³åŒ…..."
        
        # å…ˆå¤‡ä»½åŸå§‹é…ç½®
        cp .config .config.backup
        
        # æ–¹æ³•1: ç§»é™¤æ‰€æœ‰nodeç›¸å…³é…ç½®
        grep -v "CONFIG_PACKAGE_node" .config > .config.tmp
        mv .config.tmp .config
        
        # æ–¹æ³•2: æ˜ç¡®ç¦ç”¨æ‰€æœ‰nodeç›¸å…³åŒ…
        {
          echo ""
          echo "# =========================================="
          echo "# å½»åº•ç¦ç”¨ Node.js å’Œç›¸å…³åŒ…ï¼ˆè‡ªåŠ¨æ·»åŠ ï¼‰"
          echo "# =========================================="
          echo "# CONFIG_PACKAGE_node is not set"
          echo "# CONFIG_PACKAGE_node-npm is not set"
          echo "# CONFIG_PACKAGE_node-yarn is not set"
          echo "# CONFIG_PACKAGE_node-host is not set"
          echo "# CONFIG_PACKAGE_node-arduino-fs is not set"
          echo "# CONFIG_PACKAGE_node-cyassl is not set"
          echo "# CONFIG_PACKAGE_node-evented-io is not set"
          echo "# CONFIG_PACKAGE_node-ftp is not set"
          echo "# CONFIG_PACKAGE_node-hid is not set"
          echo "# CONFIG_PACKAGE_node-http-form-data is not set"
          echo "# CONFIG_PACKAGE_node-http-proxy is not set"
          echo "# CONFIG_PACKAGE_node-http-signature is not set"
          echo "# CONFIG_PACKAGE_node-jscoverage is not set"
          echo "# CONFIG_PACKAGE_node-nanomsg is not set"
          echo "# CONFIG_PACKAGE_node-serialport is not set"
          echo "# CONFIG_PACKAGE_node-tar is not set"
          echo "# CONFIG_PACKAGE_node-utf8 is not set"
          echo "# CONFIG_PACKAGE_node-zmq is not set"
          echo ""
        } >> .config
        
        # ç¡®ä¿æ ‹ä»”ä¸»é¢˜é…ç½®
        echo "ğŸ¨ é…ç½®æ ‹ä»”ä¸»é¢˜..."
        if ! grep -q "CONFIG_PACKAGE_luci-theme-dongzhai=y" .config; then
          echo "CONFIG_PACKAGE_luci-theme-dongzhai=y" >> .config
          echo "âœ… æ·»åŠ æ ‹ä»”ä¸»é¢˜ç¼–è¯‘é€‰é¡¹"
        fi
        
        # è®¾ç½®é»˜è®¤ä¸»é¢˜
        if grep -q "CONFIG_PACKAGE_luci=y" .config; then
          grep -v "CONFIG_DEFAULT_luci-theme" .config > .config.tmp
          mv .config.tmp .config
          echo "CONFIG_DEFAULT_luci-theme-dongzhai=y" >> .config
          echo "âœ… è®¾ç½®æ ‹ä»”ä¸»é¢˜ä¸ºé»˜è®¤"
        fi
        
        # åº”ç”¨é…ç½®
        echo "ğŸ”§ åº”ç”¨æœ€ç»ˆé…ç½®..."
        make defconfig
        
        # éªŒè¯Node.jsç¡®å®è¢«ç¦ç”¨
        echo ""
        echo "=== Node.js ç¦ç”¨éªŒè¯ ==="
        NODE_CONFIGS=$(grep "CONFIG_PACKAGE_node" .config || true)
        if [ -n "$NODE_CONFIGS" ]; then
          echo "âŒ å‘ç°ä»¥ä¸‹Node.jsç›¸å…³é…ç½®ï¼š"
          echo "$NODE_CONFIGS"
          echo "æ­£åœ¨å¼ºåˆ¶å¤„ç†..."
          # å†æ¬¡å¼ºåˆ¶ç¦ç”¨
          grep -v "CONFIG_PACKAGE_node" .config > .config.tmp
          mv .config.tmp .config
          echo "# CONFIG_PACKAGE_node is not set" >> .config
          make defconfig
          echo "âœ… å·²å¼ºåˆ¶å¤„ç†Node.jsé…ç½®"
        else
          echo "âœ… Node.js å·²å½»åº•ç¦ç”¨"
        fi
        
        # æ˜¾ç¤ºæœ€ç»ˆé…ç½®æ‘˜è¦
        echo ""
        echo "=== æœ€ç»ˆé…ç½®æ‘˜è¦ ==="
        echo "ç›®æ ‡è®¾å¤‡: $(grep 'CONFIG_TARGET.*DEVICE.*=y' .config | head -1 || echo 'æœªè®¾ç½®')"
        echo "å¯ç”¨ä¸»é¢˜: $(grep 'CONFIG_PACKAGE_luci-theme' .config | grep '=y' | head -3 || echo 'æ— ')"
        echo "Node.jsçŠ¶æ€: å·²å½»åº•ç¦ç”¨"

    - name: ğŸ“¦ ä¸‹è½½è½¯ä»¶åŒ…
      run: |
        cd $BUILD_DIR
        echo "=== ä¸‹è½½ä¾èµ–è½¯ä»¶åŒ… ==="
        
        THREADS=${{ github.event.inputs.compile_threads || 1 }}
        echo "ğŸ§µ ä½¿ç”¨ $THREADS ä¸ªçº¿ç¨‹ä¸‹è½½..."
        
        start_time=$(date +%s)
        make download -j$THREADS
        end_time=$(date +%s)
        duration=$((end_time - start_time))
        
        # ç»Ÿè®¡ä¸‹è½½ç»“æœ
        PKG_COUNT=$(find dl -name "*.tar.*" -o -name "*.zip" -o -name "*.bin" 2>/dev/null | wc -l || echo "0")
        echo "âœ… è½¯ä»¶åŒ…ä¸‹è½½å®Œæˆ (è€—æ—¶: ${duration}ç§’, åŒ…æ•°é‡: ${PKG_COUNT})"

    - name: ğŸ”¨ ç¼–è¯‘å›ºä»¶
      run: |
        cd $BUILD_DIR
        echo "=== å¼€å§‹ç¼–è¯‘å›ºä»¶ ==="
        
        THREADS=${{ github.event.inputs.compile_threads || 1 }}
        echo "âš¡ ä½¿ç”¨ $THREADS ä¸ªçº¿ç¨‹ç¼–è¯‘..."
        echo "â° é¢„è®¡éœ€è¦ 2-4 å°æ—¶ï¼Œè¯·è€å¿ƒç­‰å¾…..."
        
        # æ˜¾ç¤ºå¼€å§‹æ—¶é—´
        start_time=$(date +%s)
        echo "ğŸ• ç¼–è¯‘å¼€å§‹æ—¶é—´: $(date)"
        
        # ç¼–è¯‘å›ºä»¶ï¼ˆä½¿ç”¨è¯¦ç»†è¾“å‡ºä»¥ä¾¿è°ƒè¯•ï¼‰
        if [ "$THREADS" = "1" ]; then
          echo "ğŸ” ä½¿ç”¨å•çº¿ç¨‹è¯¦ç»†ç¼–è¯‘..."
          make -j1 V=s
        else
          echo "âš¡ ä½¿ç”¨å¤šçº¿ç¨‹ç¼–è¯‘..."
          make -j$THREADS
        fi
        
        # æ˜¾ç¤ºç»“æŸæ—¶é—´å’Œè€—æ—¶
        end_time=$(date +%s)
        duration=$((end_time - start_time))
        hours=$((duration / 3600))
        minutes=$(( (duration % 3600) / 60 ))
        seconds=$((duration % 60))
        
        echo "âœ… ç¼–è¯‘å®Œæˆ!"
        echo "â±ï¸  æ€»ç¼–è¯‘æ—¶é—´: ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ ${seconds}ç§’"

    - name: ğŸ“¤ æ”¶é›†ç¼–è¯‘ç»“æœ
      id: collect_firmware
      run: |
        cd $BUILD_DIR/bin/targets
        echo "=== æ”¶é›†ç¼–è¯‘ç»“æœ ==="
        
        # æŸ¥æ‰¾æ‰€æœ‰å›ºä»¶æ–‡ä»¶
        FIRMWARE_FILES=$(find . -name "*.bin" -type f)
        
        if [ -n "$FIRMWARE_FILES" ]; then
          echo "ğŸ‰ æ‰¾åˆ°ä»¥ä¸‹å›ºä»¶æ–‡ä»¶:"
          TOTAL_SIZE=0
          FILE_COUNT=0
          
          for file in $FIRMWARE_FILES; do
            if [ -f "$file" ]; then
              size=$(du -h "$file" | cut -f1)
              file_size=$(du -b "$file" | cut -f1)
              TOTAL_SIZE=$((TOTAL_SIZE + file_size))
              FILE_COUNT=$((FILE_COUNT + 1))
              echo "  ğŸ“„ $file ($size)"
            fi
          done
          
          # è®¡ç®—æ€»å¤§å°
          if [ $TOTAL_SIZE -gt 1048576 ]; then
            TOTAL_SIZE_HR=$(echo "scale=2; $TOTAL_SIZE/1048576" | bc)
            SIZE_UNIT="MB"
          else
            TOTAL_SIZE_HR=$(echo "scale=2; $TOTAL_SIZE/1024" | bc)
            SIZE_UNIT="KB"
          fi
          
          # æå–è®¾å¤‡ä¿¡æ¯
          FIRST_FILE=$(echo "$FIRMWARE_FILES" | head -1)
          DEVICE_INFO=$(echo "$FIRMWARE_FILES" | head -1 | grep -o 'targets/[^/]*/[^/]*' | cut -d'/' -f2-3 | tr '/' '_')
          
          echo "has_firmware=true" >> $GITHUB_OUTPUT
          echo "firmware_count=$FILE_COUNT" >> $GITHUB_OUTPUT
          echo "total_size=${TOTAL_SIZE_HR}${SIZE_UNIT}" >> $GITHUB_OUTPUT
          echo "device_info=$DEVICE_INFO" >> $GITHUB_ENV
          
          echo ""
          echo "ğŸ“Š ç¼–è¯‘ç»Ÿè®¡:"
          echo "  â€¢ å›ºä»¶æ•°é‡: $FILE_COUNT ä¸ª"
          echo "  â€¢ æ€»å¤§å°: ${TOTAL_SIZE_HR}${SIZE_UNIT}"
          echo "  â€¢ è®¾å¤‡å¹³å°: $DEVICE_INFO"
          
        else
          echo "âŒ æœªæ‰¾åˆ°å›ºä»¶æ–‡ä»¶!"
          echo "å½“å‰ç›®å½•å†…å®¹:"
          find . -type f | head -10
          echo "has_firmware=false" >> $GITHUB_OUTPUT
        fi

    - name: ğŸ“ ä¸Šä¼ å›ºä»¶åˆ°Artifacts
      if: steps.collect_firmware.outputs.has_firmware == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: ğŸ æ ‹ä»”å›ºä»¶_${{ env.device_info }}
        path: ${{ env.BUILD_DIR }}/bin/targets/**/*.bin
        retention-days: 30
        compression-level: 9

    - name: ğŸš€ åˆ›å»ºç‰ˆæœ¬å‘å¸ƒ
      if: steps.collect_firmware.outputs.has_firmware == 'true'
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: dongzhai-${{ env.device_info }}-$(date +%Y%m%d)
        name: ğŸ  æ ‹ä»”ä¸»é¢˜å›ºä»¶ - ${{ env.device_info }}
        body: |
          # ğŸ  æ ‹ä»”ä¸»é¢˜ä¸ªæ€§åŒ–å›ºä»¶
          
          ## ğŸ“‹ ç¼–è¯‘ä¿¡æ¯
          - **è®¾å¤‡å¹³å°**: ${{ env.device_info }}
          - **ç¼–è¯‘æ—¶é—´**: $(date)
          - **æºç ç‰ˆæœ¬**: Lean's OpenWrt
          - **å›ºä»¶æ•°é‡**: ${{ steps.collect_firmware.outputs.firmware_count }} ä¸ª
          - **æ€»å¤§å°**: ${{ steps.collect_firmware.outputs.total_size }}
          - **ç‰¹è‰²**: å½»åº•ç¦ç”¨Node.jsé¿å…ç¼–è¯‘é”™è¯¯
          
          ## ğŸ¨ ä¸»é¢˜ç‰¹è‰²
          - âœ¨ **æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜ç•Œé¢**
          - ğŸ¯ **ä¼˜åŒ–çš„ç”¨æˆ·ä½“éªŒ**
          - ğŸš« **å½»åº•ç¦ç”¨Node.jsç¡®ä¿ç¼–è¯‘æˆåŠŸ**
          
          ## ğŸ”„ åˆ·æœºè¯´æ˜
          1. **é¦–æ¬¡åˆ·æœº**: ä½¿ç”¨ `factory.bin` æ–‡ä»¶
          2. **ç³»ç»Ÿå‡çº§**: ä½¿ç”¨ `sysupgrade.bin` æ–‡ä»¶
          3. **åˆ·æœºå‰è¯·å¤‡ä»½**é‡è¦é…ç½®å’Œæ•°æ®
          
          ## âš ï¸ æ³¨æ„äº‹é¡¹
          - ç¡®ä¿é€‰æ‹©æ­£ç¡®çš„è®¾å¤‡å‹å·å›ºä»¶
          - åˆ·æœºæœ‰é£é™©ï¼Œæ“ä½œéœ€è°¨æ…
          
          ---
          *ç”± GitHub Actions è‡ªåŠ¨ç¼–è¯‘ç”Ÿæˆ*
        files: ${{ env.BUILD_DIR }}/bin/targets/**/*.bin
        draft: false
        prerelease: false

    - name: ğŸ“Š ç¼–è¯‘æ€»ç»“æŠ¥å‘Š
      if: always()
      run: |
        echo ""
        echo "================================================"
        echo "              ğŸ ç¼–è¯‘ä»»åŠ¡å®ŒæˆæŠ¥å‘Š"
        echo "================================================"
        
        if [ "${{ success() }}" = "true" ]; then
          if [ "${{ steps.collect_firmware.outputs.has_firmware }}" = "true" ]; then
            echo "ğŸ‰ âœ… ç¼–è¯‘æˆåŠŸ!"
            echo ""
            echo "ğŸ“¦ è¾“å‡ºç»“æœ:"
            echo "  â€¢ å›ºä»¶æ•°é‡: ${{ steps.collect_firmware.outputs.firmware_count }} ä¸ª"
            echo "  â€¢ æ–‡ä»¶å¤§å°: ${{ steps.collect_firmware.outputs.total_size }}"
            echo "  â€¢ è®¾å¤‡å¹³å°: ${{ env.device_info }}"
            echo ""
            echo "ğŸ“¥ ä¸‹è½½ä½ç½®:"
            echo "  â€¢ ğŸ“ Actions â†’ Artifacts â†’ ğŸ æ ‹ä»”å›ºä»¶_${{ env.device_info }}"
            echo "  â€¢ ğŸš€ Releases â†’ ğŸ  æ ‹ä»”ä¸»é¢˜å›ºä»¶ - ${{ env.device_info }}"
            echo ""
            echo "ğŸ’¡ ç‰¹è‰²: å½»åº•ç¦ç”¨Node.jsï¼Œç¼–è¯‘ç¨³å®šæ€§æå‡"
          else
            echo "âš ï¸ ç¼–è¯‘è¿‡ç¨‹å®Œæˆä½†æœªç”Ÿæˆå›ºä»¶æ–‡ä»¶"
            echo "è¯·æ£€æŸ¥ç¼–è¯‘é…ç½®å’Œè®¾å¤‡æ”¯æŒ"
          fi
        else
            echo "âŒ ç¼–è¯‘å¤±è´¥!"
            echo ""
            echo "ğŸ”§ å»ºè®®æ’æŸ¥æ­¥éª¤:"
            echo "  1. æ£€æŸ¥ .config æ–‡ä»¶é…ç½®æ˜¯å¦æ­£ç¡®"
            echo "  2. æŸ¥çœ‹è¯¦ç»†ç¼–è¯‘æ—¥å¿—å®šä½é”™è¯¯"
            echo "  3. ç¡®è®¤è®¾å¤‡å‹å·æ”¯æŒ"
        fi
        
        echo "================================================"
        echo "ç»“æŸæ—¶é—´: $(date)"
        echo "================================================"
