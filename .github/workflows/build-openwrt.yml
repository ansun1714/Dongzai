name: ç¼–è¯‘æ ‹ä»”ä¸»é¢˜å›ºä»¶

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-20.04
    
    steps:
    - name: æ£€æŸ¥ä»£ç 
      uses: actions/checkout@v4

    - name: æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
      run: |
        echo "ğŸ¯ å¼€å§‹ç¼–è¯‘æ ‹ä»”ä¸»é¢˜å›ºä»¶"
        echo "ğŸ“ å½“å‰ç›®å½•: $(pwd)"
        echo "ğŸ“„ æ–‡ä»¶åˆ—è¡¨:"
        ls -la
        echo "ğŸ”§ é…ç½®æ–‡ä»¶å†…å®¹:"
        if [ -f ".config" ]; then
          cat .config
        else
          echo "âŒ ç¼ºå°‘ .config æ–‡ä»¶"
        fi

    - name: åˆå§‹åŒ–ç¯å¢ƒ
      run: |
        echo "å®‰è£…å¿…è¦å·¥å…·..."
        sudo apt-get update
        sudo apt-get install -y git build-essential
        echo "âœ… ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ"

    - name: å…‹éš†æºç 
      run: |
        echo "å…‹éš† OpenWrt æºç ..."
        git clone https://github.com/coolsnowwolf/lede openwrt
        echo "âœ… æºç å…‹éš†å®Œæˆ"

    - name: å‡†å¤‡ç¼–è¯‘
      run: |
        cd openwrt
        echo "å‡†å¤‡ç¼–è¯‘ç¯å¢ƒ..."
        ./scripts/feeds update -a
        ./scripts/feeds install -a
        echo "âœ… ç¼–è¯‘ç¯å¢ƒå‡†å¤‡å®Œæˆ"

    - name: æµ‹è¯•ç¼–è¯‘é…ç½®
      run: |
        cd openwrt
        echo "æµ‹è¯•ç¼–è¯‘é…ç½®..."
        if [ -f "../.config" ]; then
          cp ../.config .config
          make defconfig
          echo "âœ… é…ç½®æµ‹è¯•æˆåŠŸ"
        else
          echo "âŒ ç¼ºå°‘é…ç½®æ–‡ä»¶"
          exit 1
        fi

    - name: å®Œæˆæç¤º
      run: |
        echo "ğŸ‰ åŸºç¡€ç¯å¢ƒæµ‹è¯•æˆåŠŸï¼"
        echo "ä¸‹ä¸€æ­¥å¯ä»¥å¼€å§‹å®Œæ•´ç¼–è¯‘äº†"
