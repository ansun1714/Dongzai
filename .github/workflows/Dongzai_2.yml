name: ğŸ  æ ‹ä»”ä¸»é¢˜ä¸ªæ€§åŒ–å›ºä»¶ç¼–è¯‘

on:
  workflow_dispatch:
    inputs:
      clean_build:
        description: 'æ˜¯å¦æ¸…ç†é‡æ–°ç¼–è¯‘'
        required: false
        default: false
        type: boolean
      compile_threads:
        description: 'ç¼–è¯‘çº¿ç¨‹æ•° (1-4)'
        required: false
        default: 2
        type: choice
        options:
        - 1
        - 2
        - 3
        - 4

env:
  REPO_URL: https://github.com/coolsnowwolf/lede
  BUILD_DIR: lede

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 360  # 6å°æ—¶è¶…æ—¶

    steps:
    - name: ğŸ“‹ åˆå§‹åŒ–æ£€æŸ¥
      uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: ğŸ” éªŒè¯é…ç½®æ–‡ä»¶
      id: config_check
      run: |
        echo "=== é…ç½®æ–‡ä»¶éªŒè¯ ==="
        if [ ! -f ".config" ]; then
          echo "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ° .config æ–‡ä»¶"
          echo "è¯·åœ¨ä»“åº“æ ¹ç›®å½•åˆ›å»º .config æ–‡ä»¶æ¥æŒ‡å®šè®¾å¤‡é…ç½®"
          exit 1
        fi
        
        CONFIG_LINES=$(wc -l < .config)
        echo "âœ… æ‰¾åˆ°é…ç½®æ–‡ä»¶ (.config)ï¼ŒåŒ…å« $CONFIG_LINES è¡Œé…ç½®"
        
        # æ˜¾ç¤ºå…³é”®é…ç½®ä¿¡æ¯
        echo ""
        echo "=== é…ç½®æ‘˜è¦ ==="
        echo "ç›®æ ‡å¹³å°: $(grep 'CONFIG_TARGET_[^=]*=y' .config | head -1 | sed 's/CONFIG_//')"
        echo "ç›®æ ‡è®¾å¤‡: $(grep 'CONFIG_TARGET.*DEVICE.*=y' .config | head -1 | sed 's/CONFIG_//')"
        echo "æ¶æ„ä¿¡æ¯: $(grep 'CONFIG_TARGET_ARCH' .config | head -1 | sed 's/CONFIG_//')"
        echo "LuCIç•Œé¢: $(grep 'CONFIG_PACKAGE_luci=y' .config && echo 'å¯ç”¨' || echo 'ç¦ç”¨')"
        
        # æ£€æŸ¥æ˜¯å¦ç¦ç”¨äº†Node.js
        if grep -q "# CONFIG_PACKAGE_node is not set" .config; then
          echo "âœ… Node.js å·²ç¦ç”¨ï¼ˆé¿å…ç¼–è¯‘é”™è¯¯ï¼‰"
        else
          echo "âš ï¸  å»ºè®®åœ¨é…ç½®ä¸­ç¦ç”¨ Node.js ä»¥é¿å…ç¼–è¯‘é”™è¯¯"
        fi

    - name: ğŸ› ï¸ å®‰è£…ç¼–è¯‘ç¯å¢ƒ
      run: |
        echo "=== å®‰è£…ç¼–è¯‘å·¥å…·é“¾ ==="
        start_time=$(date +%s)
        
        sudo apt-get update
        echo "ğŸ“¦ å®‰è£…åŸºç¡€ç¼–è¯‘å·¥å…·..."
        sudo apt-get install -y \
          build-essential \
          ccache \
          git \
          libncurses5-dev \
          libssl-dev \
          python3 \
          python3-pip \
          unzip \
          wget \
          curl \
          rsync \
          file \
          gawk \
          gettext \
          zlib1g-dev
        
        # å®‰è£…å®Œæ•´å·¥å…·é“¾ï¼ˆå¯é€‰ï¼Œä½†æ›´å®Œæ•´ï¼‰
        echo "ğŸ“¦ å®‰è£…å®Œæ•´OpenWrtç¼–è¯‘å·¥å…·..."
        sudo apt-get install -y \
          subversion \
          flex \
          uglifyjs \
          gcc-multilib \
          p7zip-full \
          msmtp \
          texinfo \
          libglib2.0-dev \
          xmlto \
          upx \
          libelf-dev \
          autoconf \
          automake \
          libtool \
          autopoint \
          device-tree-compiler \
          g++-multilib \
          antlr3 \
          gperf
        
        end_time=$(date +%s)
        duration=$((end_time - start_time))
        echo "âœ… ç¯å¢ƒå®‰è£…å®Œæˆ (è€—æ—¶: ${duration}ç§’)"

    - name: ğŸ“¥ å…‹éš†Leanæºç 
      run: |
        echo "=== å…‹éš†OpenWrtæºç  ==="
        
        if [ -d "$BUILD_DIR" ] && [ "${{ github.event.inputs.clean_build }}" = "true" ]; then
          echo "ğŸ§¹ æ¸…ç†æ—§ç¼–è¯‘ç›®å½•..."
          rm -rf $BUILD_DIR
        fi
        
        if [ ! -d "$BUILD_DIR" ]; then
          echo "ğŸ“¥ ä» Lean ä»“åº“å…‹éš†æºç ..."
          git clone --depth 1 $REPO_URL $BUILD_DIR
          echo "âœ… æºç å…‹éš†å®Œæˆ"
        else
          echo "âœ… ä½¿ç”¨ç°æœ‰æºç ç›®å½•"
        fi

    - name: ğŸ”„ æ›´æ–°è½¯ä»¶æº
      run: |
        cd $BUILD_DIR
        echo "=== æ›´æ–°è½¯ä»¶æºå’ŒåŒ… ==="
        
        echo "ğŸ”„ æ›´æ–°è½¯ä»¶æº..."
        ./scripts/feeds update -a
        echo "ğŸ“¦ å®‰è£…è½¯ä»¶åŒ…..."
        ./scripts/feeds install -a
        echo "âœ… è½¯ä»¶æºæ›´æ–°å®Œæˆ"

    - name: ğŸ¨ éƒ¨ç½²æ ‹ä»”ä¸»é¢˜
      run: |
        cd $BUILD_DIR
        echo "=== éƒ¨ç½²ä¸ªæ€§åŒ–ä¸»é¢˜ ==="
        
        THEME_DIR="package/lean/dongzhai-theme/luci-theme-dongzhai"
        
        # åˆ›å»ºä¸»é¢˜ç›®å½•ç»“æ„
        echo "ğŸ“ åˆ›å»ºä¸»é¢˜ç›®å½•..."
        mkdir -p $THEME_DIR/files/www/luci-static/dongzhai/{css,js,images}
        
        # åˆ›å»ºä¸»é¢˜Makefile
        echo "ğŸ“ åˆ›å»ºä¸»é¢˜ç¼–è¯‘é…ç½®..."
        cat > $THEME_DIR/Makefile << 'MAKEFILE_EOF'
include $(TOPDIR)/rules.mk

LUCI_TITLE:=æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜
LUCI_DEPENDS:=
PKG_VERSION:=1.0
PKG_RELEASE:=$(shell date +%Y%m%d)

include $(INCLUDE_DIR)/package.mk

define Package/luci-theme-dongzhai
  $(call Package/luci/webtemplate)
  TITLE:=æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜
  DEPENDS:=+luci-compat
endef

define Package/luci-theme-dongzhai/description
  ğŸ  æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜ - åŸºäºDesignä¸»é¢˜æ·±åº¦å®šåˆ¶
  ç‰¹è‰²åŠŸèƒ½ï¼š
  â€¢ æ©™è‰²ä¸»é¢˜é…è‰²
  â€¢ ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ
  â€¢ ä¸ªæ€§åŒ–å“ç‰Œæ ‡è¯†
endef

define Build/Configure
endef

define Build/Compile
endef

define Package/luci-theme-dongzhai/install
	$(INSTALL_DIR) $(1)/www/luci-static/dongzhai
	$(INSTALL_DIR) $(1)/etc/uci-defaults
	echo "ğŸ  æ ‹ä»”å®šåˆ¶å›ºä»¶ - ç¼–è¯‘æ—¶é—´: $(shell date "+%Y-%m-%d %H:%M:%S")" > $(1)/etc/dongzhai-version
	[ -d ./files ] && $(CP) ./files/* $(1)/www/luci-static/dongzhai/
endef

$(eval $(call BuildPackage,luci-theme-dongzhai))
MAKEFILE_EOF

        # åˆ›å»ºä¸»é¢˜æ ·å¼æ–‡ä»¶
        echo "ğŸ¨ åˆ›å»ºä¸»é¢˜æ ·å¼..."
        cat > $THEME_DIR/files/www/luci-static/dongzhai/css/style.css << 'CSS_EOF'
/* æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜æ ·å¼ */
:root {
  --dongzhai-primary: #ff6600;
  --dongzhai-secondary: #e65c00;
  --dongzhai-accent: #ff8533;
  --dongzhai-dark: #2c3e50;
  --dongzhai-light: #ecf0f1;
}

/* é¡¶éƒ¨å¯¼èˆªæ  */
.header .fill .brand {
  color: var(--dongzhai-primary);
  font-weight: bold;
  font-size: 18px;
}

/* ä¾§è¾¹æ  */
.sidebar {
  background: linear-gradient(135deg, var(--dongzhai-dark), #34495e);
}

.sidebar .nav > li > a {
  color: var(--dongzhai-light);
  border-left: 3px solid transparent;
  transition: all 0.3s ease;
}

.sidebar .nav > li > a:hover,
.sidebar .nav > li.active > a {
  background-color: rgba(255, 255, 255, 0.1);
  border-left-color: var(--dongzhai-primary);
}

/* ä¸»æŒ‰é’® */
.btn-primary {
  background-color: var(--dongzhai-primary);
  border-color: var(--dongzhai-primary);
  transition: all 0.3s ease;
}

.btn-primary:hover {
  background-color: var(--dongzhai-secondary);
  border-color: var(--dongzhai-secondary);
  transform: translateY(-1px);
}

/* æ ‹ä»”æ ‡è¯† */
.dongzhai-badge {
  background: linear-gradient(45deg, var(--dongzhai-primary), var(--dongzhai-accent));
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  margin-left: 5px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.7; }
  100% { opacity: 1; }
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
  .header .brand {
    font-size: 16px !important;
  }
  
  .dongzhai-badge {
    font-size: 10px;
    padding: 1px 6px;
  }
}

/* å¡ç‰‡æ ·å¼ä¼˜åŒ– */
.cbi-section .cbi-section-node-titles {
  background: linear-gradient(90deg, var(--dongzhai-primary), var(--dongzhai-accent));
  color: white;
}

.cbi-tabmenu .cbi-tab {
  border-bottom: 2px solid transparent;
}

.cbi-tabmenu .cbi-tab.current {
  border-bottom-color: var(--dongzhai-primary);
  color: var(--dongzhai-primary);
}
CSS_EOF

        # åˆ›å»ºJavaScriptå¢å¼ºï¼ˆå¯é€‰ï¼‰
        cat > $THEME_DIR/files/www/luci-static/dongzhai/js/enhancements.js << 'JS_EOF'
// æ ‹ä»”ä¸»é¢˜å¢å¼ºè„šæœ¬
document.addEventListener('DOMContentLoaded', function() {
  // æ·»åŠ æ ‹ä»”æ ‡è¯†
  const brand = document.querySelector('.header .fill .brand');
  if (brand) {
    brand.innerHTML = 'æ ‹ä»”å®šåˆ¶å›ºä»¶ <span class="dongzhai-badge">VIP</span>';
  }
  
  // æ·»åŠ åŠ è½½åŠ¨ç”»
  const style = document.createElement('style');
  style.textContent = `
    .dongzhai-loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--dongzhai-primary), var(--dongzhai-accent));
      z-index: 9999;
      animation: loading 2s ease-in-out;
    }
    
    @keyframes loading {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; opacity: 0; }
    }
  `;
  document.head.appendChild(style);
  
  const loadingBar = document.createElement('div');
  loadingBar.className = 'dongzhai-loading';
  document.body.appendChild(loadingBar);
  
  setTimeout(() => {
    loadingBar.remove();
  }, 2000);
  
  console.log('ğŸ  æ ‹ä»”ä¸»é¢˜åŠ è½½å®Œæˆ');
});
JS_EOF

        echo "âœ… æ ‹ä»”ä¸»é¢˜éƒ¨ç½²å®Œæˆ"

    - name: âš™ï¸ åº”ç”¨ç¼–è¯‘é…ç½®
      run: |
        cd $BUILD_DIR
        echo "=== åº”ç”¨ç¼–è¯‘é…ç½® ==="
        
        # å¤åˆ¶ç”¨æˆ·é…ç½®æ–‡ä»¶
        echo "ğŸ“„ åº”ç”¨ç”¨æˆ·é…ç½®..."
        cp ../.config .config
        
        # ç¡®ä¿æ ‹ä»”ä¸»é¢˜é…ç½®
        echo "ğŸ¨ é…ç½®æ ‹ä»”ä¸»é¢˜..."
        if ! grep -q "CONFIG_PACKAGE_luci-theme-dongzhai=y" .config; then
          echo "CONFIG_PACKAGE_luci-theme-dongzhai=y" >> .config
          echo "âœ… æ·»åŠ æ ‹ä»”ä¸»é¢˜ç¼–è¯‘é€‰é¡¹"
        fi
        
        # è®¾ç½®é»˜è®¤ä¸»é¢˜
        if grep -q "CONFIG_PACKAGE_luci=y" .config; then
          grep -v "CONFIG_DEFAULT_luci-theme" .config > .config.tmp
          mv .config.tmp .config
          echo "CONFIG_DEFAULT_luci-theme-dongzhai=y" >> .config
          echo "âœ… è®¾ç½®æ ‹ä»”ä¸»é¢˜ä¸ºé»˜è®¤"
        fi
        
        # åº”ç”¨é…ç½®
        echo "ğŸ”§ åº”ç”¨æœ€ç»ˆé…ç½®..."
        make defconfig
        
        # æ˜¾ç¤ºæœ€ç»ˆé…ç½®æ‘˜è¦
        echo ""
        echo "=== æœ€ç»ˆé…ç½®æ‘˜è¦ ==="
        echo "ç›®æ ‡è®¾å¤‡: $(grep 'CONFIG_TARGET.*DEVICE.*=y' .config | head -1)"
        echo "å¯ç”¨ä¸»é¢˜: $(grep 'CONFIG_PACKAGE_luci-theme' .config | grep '=y' | head -3)"
        echo "é»˜è®¤ä¸»é¢˜: $(grep 'CONFIG_DEFAULT_luci-theme' .config)"

    - name: ğŸ“¦ ä¸‹è½½è½¯ä»¶åŒ…
      run: |
        cd $BUILD_DIR
        echo "=== ä¸‹è½½ä¾èµ–è½¯ä»¶åŒ… ==="
        
        THREADS=${{ github.event.inputs.compile_threads || 2 }}
        echo "ğŸ§µ ä½¿ç”¨ $THREADS ä¸ªçº¿ç¨‹ä¸‹è½½..."
        
        start_time=$(date +%s)
        make download -j$THREADS
        end_time=$(date +%s)
        duration=$((end_time - start_time))
        
        # ç»Ÿè®¡ä¸‹è½½ç»“æœ
        PKG_COUNT=$(find dl -name "*.tar.*" -o -name "*.zip" -o -name "*.bin" 2>/dev/null | wc -l || echo "0")
        echo "âœ… è½¯ä»¶åŒ…ä¸‹è½½å®Œæˆ (è€—æ—¶: ${duration}ç§’, åŒ…æ•°é‡: ${PKG_COUNT})"

    - name: ğŸ”¨ ç¼–è¯‘å›ºä»¶
      run: |
        cd $BUILD_DIR
        echo "=== å¼€å§‹ç¼–è¯‘å›ºä»¶ ==="
        
        THREADS=${{ github.event.inputs.compile_threads || 2 }}
        echo "âš¡ ä½¿ç”¨ $THREADS ä¸ªçº¿ç¨‹ç¼–è¯‘..."
        echo "â° é¢„è®¡éœ€è¦ 2-4 å°æ—¶ï¼Œè¯·è€å¿ƒç­‰å¾…..."
        
        # æ˜¾ç¤ºå¼€å§‹æ—¶é—´
        start_time=$(date +%s)
        echo "ğŸ• ç¼–è¯‘å¼€å§‹æ—¶é—´: $(date)"
        
        # ç¼–è¯‘å›ºä»¶
        make -j$THREADS
        
        # æ˜¾ç¤ºç»“æŸæ—¶é—´å’Œè€—æ—¶
        end_time=$(date +%s)
        duration=$((end_time - start_time))
        hours=$((duration / 3600))
        minutes=$(( (duration % 3600) / 60 ))
        seconds=$((duration % 60))
        
        echo "âœ… ç¼–è¯‘å®Œæˆ!"
        echo "â±ï¸  æ€»ç¼–è¯‘æ—¶é—´: ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ ${seconds}ç§’"

    - name: ğŸ“¤ æ”¶é›†ç¼–è¯‘ç»“æœ
      id: collect_firmware
      run: |
        cd $BUILD_DIR/bin/targets
        echo "=== æ”¶é›†ç¼–è¯‘ç»“æœ ==="
        
        # æŸ¥æ‰¾æ‰€æœ‰å›ºä»¶æ–‡ä»¶
        FIRMWARE_FILES=$(find . -name "*.bin" -type f)
        
        if [ -n "$FIRMWARE_FILES" ]; then
          echo "ğŸ‰ æ‰¾åˆ°ä»¥ä¸‹å›ºä»¶æ–‡ä»¶:"
          TOTAL_SIZE=0
          FILE_COUNT=0
          
          for file in $FIRMWARE_FILES; do
            if [ -f "$file" ]; then
              size=$(du -h "$file" | cut -f1)
              file_size=$(du -b "$file" | cut -f1)
              TOTAL_SIZE=$((TOTAL_SIZE + file_size))
              FILE_COUNT=$((FILE_COUNT + 1))
              echo "  ğŸ“„ $file ($size)"
            fi
          done
          
          # è®¡ç®—æ€»å¤§å°
          if [ $TOTAL_SIZE -gt 1048576 ]; then
            TOTAL_SIZE_HR=$(echo "scale=2; $TOTAL_SIZE/1048576" | bc)
            SIZE_UNIT="MB"
          else
            TOTAL_SIZE_HR=$(echo "scale=2; $TOTAL_SIZE/1024" | bc)
            SIZE_UNIT="KB"
          fi
          
          # æå–è®¾å¤‡ä¿¡æ¯
          FIRST_FILE=$(echo "$FIRMWARE_FILES" | head -1)
          DEVICE_INFO=$(echo "$FIRMWARE_FILES" | head -1 | grep -o 'targets/[^/]*/[^/]*' | cut -d'/' -f2-3 | tr '/' '_')
          
          echo "has_firmware=true" >> $GITHUB_OUTPUT
          echo "firmware_count=$FILE_COUNT" >> $GITHUB_OUTPUT
          echo "total_size=${TOTAL_SIZE_HR}${SIZE_UNIT}" >> $GITHUB_OUTPUT
          echo "device_info=$DEVICE_INFO" >> $GITHUB_ENV
          
          echo ""
          echo "ğŸ“Š ç¼–è¯‘ç»Ÿè®¡:"
          echo "  â€¢ å›ºä»¶æ•°é‡: $FILE_COUNT ä¸ª"
          echo "  â€¢ æ€»å¤§å°: ${TOTAL_SIZE_HR}${SIZE_UNIT}"
          echo "  â€¢ è®¾å¤‡å¹³å°: $DEVICE_INFO"
          
        else
          echo "âŒ æœªæ‰¾åˆ°å›ºä»¶æ–‡ä»¶!"
          echo "å½“å‰ç›®å½•å†…å®¹:"
          find . -type f | head -10
          echo "has_firmware=false" >> $GITHUB_OUTPUT
        fi

    - name: ğŸ“ ä¸Šä¼ å›ºä»¶åˆ°Artifacts
      if: steps.collect_firmware.outputs.has_firmware == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: ğŸ æ ‹ä»”å›ºä»¶_${{ env.device_info }}
        path: ${{ env.BUILD_DIR }}/bin/targets/**/*.bin
        retention-days: 30
        compression-level: 9

    - name: ğŸš€ åˆ›å»ºç‰ˆæœ¬å‘å¸ƒ
      if: steps.collect_firmware.outputs.has_firmware == 'true'
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: dongzhai-${{ env.device_info }}-$(date +%Y%m%d)
        name: ğŸ  æ ‹ä»”ä¸»é¢˜å›ºä»¶ - ${{ env.device_info }}
        body: |
          # ğŸ  æ ‹ä»”ä¸»é¢˜ä¸ªæ€§åŒ–å›ºä»¶
          
          ## ğŸ“‹ ç¼–è¯‘ä¿¡æ¯
          - **è®¾å¤‡å¹³å°**: ${{ env.device_info }}
          - **ç¼–è¯‘æ—¶é—´**: $(date)
          - **æºç ç‰ˆæœ¬**: Lean's OpenWrt (coolsnowwolf/lede)
          - **å›ºä»¶æ•°é‡**: ${{ steps.collect_firmware.outputs.firmware_count }} ä¸ª
          - **æ€»å¤§å°**: ${{ steps.collect_firmware.outputs.total_size }}
          
          ## ğŸ¨ ä¸»é¢˜ç‰¹è‰²
          - âœ¨ **æ ‹ä»”ä¸ªæ€§åŒ–ä¸»é¢˜ç•Œé¢**
          - ğŸ¯ **ä¼˜åŒ–çš„ç”¨æˆ·ä½“éªŒ**
          - ğŸ“± **å®Œå–„çš„ç§»åŠ¨ç«¯æ”¯æŒ**
          - ğŸ”§ **åŸºäºLeanç¨³å®šæºç **
          - ğŸš€ **æ€§èƒ½ä¼˜åŒ–é…ç½®**
          
          ## ğŸ“¦ åŒ…å«åŠŸèƒ½
          - æ ‹ä»”æ·±åº¦å®šåˆ¶ä¸»é¢˜
          - å¸¸ç”¨ç½‘ç»œå·¥å…·é›†
          - ç³»ç»Ÿç®¡ç†å·¥å…·
          - æ©™è‰²ä¸»é¢˜é…è‰²æ–¹æ¡ˆ
          
          ## ğŸ”„ åˆ·æœºè¯´æ˜
          1. **é¦–æ¬¡åˆ·æœº**: ä½¿ç”¨ `factory.bin` æ–‡ä»¶
          2. **ç³»ç»Ÿå‡çº§**: ä½¿ç”¨ `sysupgrade.bin` æ–‡ä»¶
          3. **åˆ·æœºå‰è¯·å¤‡ä»½**é‡è¦é…ç½®å’Œæ•°æ®
          
          ## âš ï¸ æ³¨æ„äº‹é¡¹
          - ç¡®ä¿é€‰æ‹©æ­£ç¡®çš„è®¾å¤‡å‹å·å›ºä»¶
          - åˆ·æœºæœ‰é£é™©ï¼Œæ“ä½œéœ€è°¨æ…
          - å»ºè®®åœ¨ä¸“ä¸šäººå£«æŒ‡å¯¼ä¸‹è¿›è¡Œ
          
          ## ğŸ› é—®é¢˜åé¦ˆ
          å¦‚é‡é—®é¢˜ï¼Œè¯·æäº¤ Issue å¹¶æä¾›ï¼š
          - è®¾å¤‡å‹å·ä¿¡æ¯
          - å…·ä½“çš„é”™è¯¯ç°è±¡
          - ç›¸å…³æ—¥å¿—ä¿¡æ¯
          
          ---
          *ç”± GitHub Actions è‡ªåŠ¨ç¼–è¯‘ç”Ÿæˆ*
        files: ${{ env.BUILD_DIR }}/bin/targets/**/*.bin
        draft: false
        prerelease: false
        discussion_category_name: 'Announcements'

    - name: ğŸ“Š ç¼–è¯‘æ€»ç»“æŠ¥å‘Š
      if: always()
      run: |
        echo ""
        echo "================================================"
        echo "              ğŸ ç¼–è¯‘ä»»åŠ¡å®ŒæˆæŠ¥å‘Š"
        echo "================================================"
        
        if [ "${{ success() }}" = "true" ]; then
          if [ "${{ steps.collect_firmware.outputs.has_firmware }}" = "true" ]; then
            echo "ğŸ‰ âœ… ç¼–è¯‘æˆåŠŸ!"
            echo ""
            echo "ğŸ“¦ è¾“å‡ºç»“æœ:"
            echo "  â€¢ å›ºä»¶æ•°é‡: ${{ steps.collect_firmware.outputs.firmware_count }} ä¸ª"
            echo "  â€¢ æ–‡ä»¶å¤§å°: ${{ steps.collect_firmware.outputs.total_size }}"
            echo "  â€¢ è®¾å¤‡å¹³å°: ${{ env.device_info }}"
            echo ""
            echo "ğŸ“¥ ä¸‹è½½ä½ç½®:"
            echo "  â€¢ ğŸ“ Actions â†’ Artifacts â†’ ğŸ æ ‹ä»”å›ºä»¶_${{ env.device_info }}"
            echo "  â€¢ ğŸš€ Releases â†’ ğŸ  æ ‹ä»”ä¸»é¢˜å›ºä»¶ - ${{ env.device_info }}"
          else
            echo "âš ï¸ ç¼–è¯‘è¿‡ç¨‹å®Œæˆä½†æœªç”Ÿæˆå›ºä»¶æ–‡ä»¶"
            echo "è¯·æ£€æŸ¥ç¼–è¯‘é…ç½®å’Œè®¾å¤‡æ”¯æŒ"
          fi
        else
            echo "âŒ ç¼–è¯‘å¤±è´¥!"
            echo ""
            echo "ğŸ”§ å»ºè®®æ’æŸ¥æ­¥éª¤:"
            echo "  1. æ£€æŸ¥ .config æ–‡ä»¶é…ç½®æ˜¯å¦æ­£ç¡®"
            echo "  2. æŸ¥çœ‹è¯¦ç»†ç¼–è¯‘æ—¥å¿—å®šä½é”™è¯¯"
            echo "  3. å°è¯•å‡å°‘ç¼–è¯‘çº¿ç¨‹æ•°"
            echo "  4. ç¡®è®¤è®¾å¤‡å‹å·æ”¯æŒ"
        fi
        
        echo "================================================"
        echo "å¼€å§‹æ—¶é—´: $(date -d @${{ job.steps.install_env.outputs.start_time }} 2>/dev/null || echo 'æœªçŸ¥')"
        echo "ç»“æŸæ—¶é—´: $(date)"
        echo "================================================"

    - name: ğŸ’¾ æ¸…ç†å·¥ä½œç©ºé—´
      if: always()
      run: |
        echo "ğŸ§¹ æ¸…ç†å·¥ä½œç©ºé—´..."
        # ä¿ç•™ç¼–è¯‘ç›®å½•ä»¥ä¾›è°ƒè¯•ï¼Œå®é™…æ¸…ç†ç”±GitHubè‡ªåŠ¨å¤„ç†
        echo "âœ… æ¸…ç†å®Œæˆ"
